<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\..\default_typedef.xml"/>
  <Form id="VAN_DS_SC_1320" classname="VAN_DS_SC_1320" left="0" top="0" width="803" height="490" titletext="탄력가격업체 거래관계 등록(R3)" onload="form_onload">
    <Layouts>
      <Layout>
        <Div id="Div01" taborder="0" url="common::location.xfdl" text="Div01" left="0" top="0" right="563" height="21"/>
        <Button id="btn_search00" taborder="2" onclick="btn_search00_onclick" cssclass="btn_WFSA_Searchbtn" top="0" right="15" width="58" height="21"/>
        <Div id="div_search" taborder="3" left="0" top="29" right="15" height="69" cssclass="div_WFSA_Searchbg">
          <Layouts>
            <Layout>
              <Static id="sta_00" taborder="50" text="수요처(농협)" cssclass="sta_WFSA_Label" left="15" top="10" width="106" height="21"/>
              <Static id="sta_02" taborder="51" text="거래관계" cssclass="sta_WFSA_Label" left="15" top="36" width="106" height="21"/>
              <Radio id="rdo_store_chk00" taborder="54" index="0" codecolumn="codecolumn" datacolumn="datacolumn" value="1" direction="vertical" left="121" top="10" width="147" height="21" onitemchanged="div_search_rdo_store_chk00_onitemchanged">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">1</Col>
                      <Col id="datacolumn">수요처</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">2</Col>
                      <Col id="datacolumn">지역</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Radio>
              <Static id="Static00" taborder="55" text="-" left="257" top="36" width="10" height="21"/>
              <Edit id="edt_data00" taborder="56" inputtype="number" cssclass="WF_Essential" left="121" top="36" width="131" height="21" value="농협하나로유통"/>
              <Edit id="edt_data01" taborder="57" cssclass="WF_Essential" left="268" top="36" width="150" height="21"/>
              <Combo id="cbo_local_code" taborder="61" value="11" text="[1100]서울" codecolumn="codecolumn" datacolumn="datacolumn" index="0" left="268" top="10" width="103" height="21" visible="false">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">11</Col>
                      <Col id="datacolumn">[1100]서울</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">21</Col>
                      <Col id="datacolumn">[2100]부산</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">22</Col>
                      <Col id="datacolumn">[2200]인천</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">23</Col>
                      <Col id="datacolumn">[2300]대구</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">24</Col>
                      <Col id="datacolumn">[2400]광주</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">25</Col>
                      <Col id="datacolumn">[2500]대전</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">26</Col>
                      <Col id="datacolumn">[2600]울산</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">31</Col>
                      <Col id="datacolumn">[3100]경기</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">32</Col>
                      <Col id="datacolumn">[3200]강원</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">33</Col>
                      <Col id="datacolumn">[3300]충북</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">34</Col>
                      <Col id="datacolumn">[3400]충남</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">35</Col>
                      <Col id="datacolumn">[3500]전북</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">36</Col>
                      <Col id="datacolumn">[3600]전남</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">37</Col>
                      <Col id="datacolumn">[3700]경북</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">38</Col>
                      <Col id="datacolumn">[3800]경남</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">39</Col>
                      <Col id="datacolumn">[3900]제주</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">40</Col>
                      <Col id="datacolumn">[4000]세종</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">99</Col>
                      <Col id="datacolumn">[9900]기타대</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Combo>
              <Combo id="cbo_local_code01" taborder="62" left="268" top="10" width="74" height="21" codecolumn="codecolumn" datacolumn="datacolumn" value="1" text="명칭">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">1</Col>
                      <Col id="datacolumn">명칭</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">2</Col>
                      <Col id="datacolumn">코드</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Combo>
              <Edit id="edt_bzp_text00" taborder="63" left="345" top="10" width="175" height="21" onkeydown="div_search_edt_bzp_text00_onkeydown"/>
              <Static id="Static01" taborder="64" text="5" visible="false" left="270" top="31" width="103" height="5" style="background:#dc143c5b;"/>
              <Static id="sta_sep_val" taborder="65" text="0" left="686" top="37" height="21" width="60" visible="false"/>
              <Static id="sta_cser_c" taborder="66" left="547" top="10" height="21" width="67" visible="false" style="border:1 solid #808080ff ;"/>
              <Static id="sta_cser_team" taborder="67" left="619" top="10" height="21" width="59" visible="false" style="border:1 solid #808080ff ;"/>
              <Static id="sta_cser_amnno" taborder="68" left="683" top="10" width="59" height="21" visible="false" style="border:1 solid #808080ff ;"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_list" taborder="4" left="0" top="97" bottom="0" scrollbars="none" right="15">
          <Layouts>
            <Layout width="788" height="317">
              <Grid id="grd_main" taborder="26" binddataset="ds_master_data" useinputpanel="false" autofittype="none" left="0" top="41" bottom="0" width="400">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="45"/>
                      <Column size="45"/>
                      <Column size="100"/>
                      <Column size="80"/>
                      <Column size="260"/>
                    </Columns>
                    <Rows>
                      <Row size="30" band="head"/>
                      <Row size="28"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="순번"/>
                      <Cell col="1" text="선택"/>
                      <Cell col="2" text="수요처코드"/>
                      <Cell col="3" text="팀코드"/>
                      <Cell col="4" text="수요처명"/>
                    </Band>
                    <Band id="body">
                      <Cell expr="expr:currow+1"/>
                      <Cell col="1" displaytype="checkbox" edittype="checkbox" text="bind:CHECK_YN"/>
                      <Cell col="2" text="bind:CSER_NA_TRPL_C"/>
                      <Cell col="3" text="bind:CSER_NA_TEAM_C"/>
                      <Cell col="4" style="align:left;" text="bind:CLNTNM"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_toggle00" taborder="27" cssclass="btn_WFSA_SearchClose" left="363" top="0" right="362" height="12" onclick="div_list_btn_toggle00_onclick"/>
              <Grid id="grd_detail" taborder="28" binddataset="ds_detail_data" useinputpanel="false" left="418" top="41" bottom="0" right="0">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="45"/>
                      <Column size="45"/>
                      <Column size="200"/>
                      <Column size="200"/>
                      <Column size="60"/>
                      <Column size="260"/>
                      <Column size="60"/>
                      <Column size="45"/>
                      <Column size="140"/>
                      <Column size="80"/>
                      <Column size="130"/>
                    </Columns>
                    <Rows>
                      <Row size="30" band="head"/>
                      <Row size="28"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="순번"/>
                      <Cell col="1" text="선택"/>
                      <Cell col="2" text="현 공급처"/>
                      <Cell col="3" text="수요처~공급업체 계약"/>
                      <Cell col="4" text="팀"/>
                      <Cell col="5" text="변경수요처"/>
                      <Cell col="6" text="팀"/>
                      <Cell col="7" text="삭제"/>
                      <Cell col="8" text="계약유형"/>
                      <Cell col="9" text="공급유형"/>
                      <Cell col="10" text="공급처코드"/>
                    </Band>
                    <Band id="body">
                      <Cell text="expr:currow+1"/>
                      <Cell col="1" displaytype="checkbox" edittype="checkbox" text="bind:CHECK_YN"/>
                      <Cell col="2" style="align:left;" text="bind:CLNTNM"/>
                      <Cell col="3" style="align:left;" text="bind:CSER_NA_TRPL_N"/>
                      <Cell col="4" text="bind:CSER_NA_TEAM_N"/>
                      <Cell col="5" style="align:left;" text="bind:UPDATE_CSER_NA_TRPL_N"/>
                      <Cell col="6" text="bind:UPDATE_CSER_NA_TEAM_C"/>
                      <Cell col="7" displaytype="checkbox" edittype="none" text="bind:DELETE_YN"/>
                      <Cell col="8" text="bind:UPDATE_CSER_CTR_TPC"/>
                      <Cell col="9" text="bind:UPDATE_SPY_TPC"/>
                      <Cell col="10" text="bind:NA_TRPL_C"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="Static03" taborder="29" text="15" visible="false" left="0" top="0" width="103" height="15" style="background:#dc143c5b;"/>
              <Static id="sta_pagename00" taborder="30" text="주관사업장 [주관사업장이 농협하나로유통인 3자 계통 거래관계 생성]" cssclass="sta_WF_Subtitle" left="0" top="15" width="500" height="21"/>
              <Static id="Static00" taborder="31" text="5" visible="false" left="0" top="36" width="103" height="5" style="background:#dc143c5b;"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_help" taborder="5" text="도움말" onclick="btn_help_onclick" cssclass="btn_WF_CRUD" top="0" right="118" width="53" height="21"/>
        <Button id="btn_save00" taborder="6" text="저장" onclick="btn_save00_onclick" cssclass="btn_WF_CRUD" top="0" right="75" height="21" width="41"/>
        <Button id="btn_clear00" taborder="7" text="초기화" onclick="btn_clear00_onclick" cssclass="btn_WF_CRUD" top="0" right="173" width="53" height="21"/>
        <Button id="btn_popup01" taborder="8" text="요청거래관계검색" onclick="btn_popup01_onclick" cssclass="btn_WF_CRUD" top="0" right="228" width="113" height="21" visible="false"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_master_data" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CLNTNM" type="STRING" size="256"/>
          <Column id="CSER_NA_TEAM_N" type="STRING" size="256"/>
          <Column id="CSER_CTR_TPC" type="STRING" size="256"/>
          <Column id="SPY_TPC" type="STRING" size="256"/>
          <Column id="MNGT_NA_TR_TPC" type="STRING" size="256"/>
          <Column id="NA_WRS_LCLC" type="STRING" size="256"/>
          <Column id="NA_WRS_MCLC" type="STRING" size="256"/>
          <Column id="CSER_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="CSER_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="SPLR_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="SPLR_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="MNGT_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="MNGT_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="CSER_TR_REL_AMNNO" type="STRING" size="256"/>
          <Column id="CHECK_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ROTS_FLEX_PR_APL_YN" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="NA_MBCO_DSC" type="STRING" size="256"/>
          <Column id="NA_TRPL_C" type="STRING" size="256"/>
          <Column id="CLNTNM" type="STRING" size="256"/>
          <Column id="CHECK_YN" type="STRING" size="256"/>
          <Column id="ROTS_FLEX_PR_APL_YN" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_detail_data" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CLNTNM" type="STRING" size="256"/>
          <Column id="CSER_NA_TEAM_N" type="STRING" size="256"/>
          <Column id="CSER_CTR_TPC" type="STRING" size="256"/>
          <Column id="CTR_TPNM" type="STRING" size="256"/>
          <Column id="SPY_TPC" type="STRING" size="256"/>
          <Column id="SPY_TPNM" type="STRING" size="256"/>
          <Column id="MNGT_NA_TR_TPC" type="STRING" size="256"/>
          <Column id="NA_WRS_LCLC" type="STRING" size="256"/>
          <Column id="NA_WRS_MCLC" type="STRING" size="256"/>
          <Column id="CSER_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="CSER_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="SPLR_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="SPLR_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="MNGT_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="MNGT_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="CSER_TR_REL_AMNNO" type="STRING" size="256"/>
          <Column id="CHECK_YN" type="STRING" size="256"/>
          <Column id="DELETE_YN" type="STRING" size="256"/>
          <Column id="UPDATE_CSER_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="UPDATE_CSER_NA_TRPL_N" type="STRING" size="256"/>
          <Column id="UPDATE_CSER_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="UPDATE_SPLR_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="UPDATE_SPLR_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="UPDATE_CSER_CTR_TPC" type="STRING" size="256"/>
          <Column id="UPDATE_SPY_TPC" type="STRING" size="256"/>
          <Column id="UPDATE_MNGT_NA_TRPL_C" type="STRING" size="256"/>
          <Column id="UPDATE_MNGT_NA_TEAM_C" type="STRING" size="256"/>
          <Column id="UPDATE_MNGT_NA_TR_TPC" type="STRING" size="256"/>
          <Column id="UPDATE_NA_WRS_LCLC" type="STRING" size="256"/>
          <Column id="UPDATE_NA_WRS_MCLC" type="STRING" size="256"/>
          <Column id="T1_CSER_TR_REL_AMNNO" type="STRING" size="256"/>
          <Column id="NA_TRPL_C" type="STRING" size="256"/>
          <Column id="NA_TEAM_C" type="STRING" size="256"/>
          <Column id="AMNNO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cser_ctr_tpc" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="SIMP_C" type="STRING" size="256"/>
          <Column id="SIMP_CNM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_spy_tpc" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="SIMP_C" type="STRING" size="256"/>
          <Column id="SIMP_CNM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript5.0"><![CDATA[include "lib::comLib.xjs";

var TRPL_C = application.gv_glnCode;		//권한사업장
//var TRPL_C = '2900004700013';				//권한사업장 (엘지)
var TRPL_N = application.gv_companyName;	//로그인 회사명

this.form_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	this.gfn_setInitForm(obj, e); //공통
}


this.fn_afterFormOnload = function() //onload
{
	var param = [
 		{code:"CSER_CTR_TPC", dsName:"ds_cser_ctr_tpc", selecttype:"A"}, 	// 0.계약유형
 		{code:"SPY_TPC", dsName:"ds_spy_tpc", selecttype:"A"} 				// 1.공급유형
 	];
	this.gfn_setCommonCode(param);
	
	if(application.gv_mbcoType != "1"){
		obj.alert('본사만 거래관계를 맺을 수 있습니다.');
		return;
	}
	
	this.addEventSingleCheckbox(this.div_list.grd_main); 	// 하나의 체크박스만 체크 가능(그리드)
	this.div_list.grd_detail.afterFnc = this.update_chk;	// 마스터 테이블 체크 박스 클릭 시
	this.gridCheckboxInit([this.div_list.grd_detail]); 		// 체크박스 이벤트 등록
	this.div_search.edt_data01.set_value(TRPL_N);			// 거래관계
	
	this.btnDisable(this.btn_save00);
	
	//그리드클릭 이벤트 등록
	this.div_list.grd_main.addEventHandler("oncellclick", this.grd_afterFnc, this);
	this.div_list.grd_detail.addEventHandler('oncellclick',this.delete_chk,this);
	
	// 처음 조회 시 계통탄력가격적용여부에 따라 조회 가능 여부 판단
	this.initflex();
}

//오른쪽 사업장 체크박스 클릭 시 변경 사업장 입력
this.update_chk = function(obj, result, row)
{
	var mindex = 0;
	for(var i=0; i<obj.ds_master_data.rowcount; i++){
		if(obj.ds_master_data.getColumn(i,"CHECK_YN") == 1){
			mindex = i;
			break;
		}
	}
	
	var cs_trpl_c = obj.ds_master_data.getColumn(mindex,"CSER_NA_TRPL_C"); 		// 왼쪽 그리드 수요거래처코드
 	var clntnm = obj.ds_master_data.getColumn(mindex,"CLNTNM"); 				// 왼쪽 그리드 수요거래처명
 	var cs_team_c = obj.ds_master_data.getColumn(mindex,"CSER_NA_TEAM_C"); 		// 왼쪽 그리드 수요거래처팀코드
 	var sp_trpl_c = obj.ds_master_data.getColumn(mindex,"SPLR_NA_TRPL_C");
 	var sp_team_c = obj.ds_master_data.getColumn(mindex,"SPLR_NA_TEAM_C");
 	var cser_ctr_tpc = obj.ds_master_data.getColumn(mindex,"CSER_CTR_TPC"); 	// 왼쪽 그리드 계약유형
 	var spy_tpc = obj.ds_master_data.getColumn(mindex,"SPY_TPC"); 				// 왼쪽 그리드 공급유형
	var mn_trpl_c = obj.ds_master_data.getColumn(mindex,"MNGT_NA_TRPL_C");
	var mn_team_c = obj.ds_master_data.getColumn(mindex,"MNGT_NA_TEAM_C");
	var tr_tpc = obj.ds_master_data.getColumn(mindex,"MNGT_NA_TR_TPC");
	var wrs_lclc = obj.ds_master_data.getColumn(mindex,"NA_WRS_LCLC");
	var wrs_mclc = obj.ds_master_data.getColumn(mindex,"NA_WRS_MCLC");
	var cser_amnno = obj.ds_master_data.getColumn(mindex,"CSER_TR_REL_AMNNO");
	
	var cser_c = obj.ds_detail_data.getColumn(row,"CSER_NA_TRPL_C");			// 오른쪽 그리드 수요처코드
	
	if(result == true){
		if(cs_trpl_c == cser_c){
			obj.alert('현재 수요처와 변경 수요처가 동일합니다.');
			obj.ds_detail_data.setColumn(row,"CHECK_YN","0");
			return;
		}
		var cser_ctr_n = ""; 
		var spy_tpc_n = "";
		for(var y=0;y<obj.ds_cser_ctr_tpc.rowcount;y++){
			if(obj.ds_cser_ctr_tpc.getColumn(y,"SIMP_C") == cser_ctr_tpc){
				cser_ctr_n = obj.ds_cser_ctr_tpc.getColumn(y,"SIMP_CNM");
			}
		}
		for(var m=0;m<obj.ds_spy_tpc.rowcount;m++){
			if(obj.ds_spy_tpc.getColumn(m,"SIMP_C") == spy_tpc){
				spy_tpc_n = obj.ds_spy_tpc.getColumn(m,"SIMP_CNM");
			}
		}
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_NA_TRPL_C",cs_trpl_c);
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_NA_TRPL_N",clntnm);
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_NA_TEAM_C",cs_team_c);
		obj.ds_detail_data.setColumn(row,"UPDATE_SPLR_NA_TRPL_C",sp_trpl_c);
		obj.ds_detail_data.setColumn(row,"UPDATE_SPLR_NA_TEAM_C",sp_team_c);
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_CTR_TPC",cser_ctr_tpc);
		obj.ds_detail_data.setColumn(row,"UPDATE_SPY_TPC",spy_tpc);
		obj.ds_detail_data.setColumn(row,"UPDATE_MNGT_NA_TRPL_C",mn_trpl_c);
		obj.ds_detail_data.setColumn(row,"UPDATE_MNGT_NA_TEAM_C",mn_team_c);
		obj.ds_detail_data.setColumn(row,"UPDATE_MNGT_NA_TR_TPC",tr_tpc);
		obj.ds_detail_data.setColumn(row,"UPDATE_NA_WRS_LCLC",wrs_lclc);
		obj.ds_detail_data.setColumn(row,"UPDATE_NA_WRS_MCLC",wrs_mclc);
		obj.ds_detail_data.setColumn(row,"T1_CSER_TR_REL_AMNNO",cser_amnno);
	}else{
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_NA_TRPL_C","");
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_NA_TRPL_N","");
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_NA_TEAM_C","");
		obj.ds_detail_data.setColumn(row,"UPDATE_SPLR_NA_TRPL_C","");
		obj.ds_detail_data.setColumn(row,"UPDATE_SPLR_NA_TEAM_C","");
		obj.ds_detail_data.setColumn(row,"UPDATE_CSER_CTR_TPC","");
		obj.ds_detail_data.setColumn(row,"UPDATE_SPY_TPC","");
		obj.ds_detail_data.setColumn(row,"UPDATE_MNGT_NA_TRPL_C","");
		obj.ds_detail_data.setColumn(row,"UPDATE_MNGT_NA_TEAM_C","");
		obj.ds_detail_data.setColumn(row,"UPDATE_MNGT_NA_TR_TPC","");
		obj.ds_detail_data.setColumn(row,"UPDATE_NA_WRS_LCLC","");
		obj.ds_detail_data.setColumn(row,"UPDATE_NA_WRS_MCLC","");
		obj.ds_detail_data.setColumn(row,"T1_CSER_TR_REL_AMNNO","");
	}
}

// 삭제 클릭
this.delete_chk = function(obj, e)
{
	if (e.cell == 7) {
		var row = e.row;
		
		if (this.ds_detail_data.getColumn(row, "DELETE_YN") == "0") {
			if (this.gfn_nullToEmpty(this.ds_detail_data.getColumn(row, "UPDATE_CSER_NA_TRPL_N")) != "") {
				this.alert('변경수요처가 존재할 경우 삭제할 수 없습니다.');
				return;
			}
			if (this.gfn_nullToEmpty(this.ds_detail_data.getColumn(row, "CSER_NA_TRPL_N")) == "") {
				this.alert('삭제할 거래관계가 없습니다. 거래관계를 확인하십시요.');
				return;
			}
			
			for (var i = 0; i < this.ds_master_data.rowcount; i++) {
				if (this.ds_master_data.getColumn(i, "CHECK_YN") == "1") { // 왼쪽 그리드 체크 index
					this.ds_detail_data.setColumn(row, "DELETE_YN", "1"); // 삭제 선택
					
					this.ds_detail_data.setColumn(row, "UPDATE_CSER_NA_TRPL_C", this.ds_master_data.getColumn(i, "CSER_NA_TRPL_C"));	// 수요거래처코드
					
					this.ds_detail_data.setColumn(row, "UPDATE_CSER_NA_TEAM_C", this.ds_master_data.getColumn(i, "CSER_NA_TEAM_C"));	// 수요거래처팀코드
					this.ds_detail_data.setColumn(row, "UPDATE_SPLR_NA_TRPL_C", this.ds_master_data.getColumn(i, "SPLR_NA_TRPL_C"));
					this.ds_detail_data.setColumn(row, "UPDATE_SPLR_NA_TEAM_C", this.ds_master_data.getColumn(i, "SPLR_NA_TEAM_C"));
					
					this.ds_detail_data.setColumn(row, "UPDATE_MNGT_NA_TRPL_C", this.ds_master_data.getColumn(i, "MNGT_NA_TRPL_C"));
					this.ds_detail_data.setColumn(row, "UPDATE_MNGT_NA_TEAM_C", this.ds_master_data.getColumn(i, "MNGT_NA_TEAM_C"));
					this.ds_detail_data.setColumn(row, "UPDATE_MNGT_NA_TR_TPC", this.ds_master_data.getColumn(i, "MNGT_NA_TR_TPC"));
					this.ds_detail_data.setColumn(row, "UPDATE_NA_WRS_LCLC",    this.ds_master_data.getColumn(i, "NA_WRS_LCLC"));
					this.ds_detail_data.setColumn(row, "UPDATE_NA_WRS_MCLC",    this.ds_master_data.getColumn(i, "NA_WRS_MCLC"));
					this.ds_detail_data.setColumn(row, "T1_CSER_TR_REL_AMNNO",  this.ds_master_data.getColumn(i, "CSER_TR_REL_AMNNO"));
					
					break;
				}
			}
			
		} else {
			this.ds_detail_data.setColumn(row, "DELETE_YN", "0"); // 삭제 해제
			
			this.ds_detail_data.setColumn(row, "UPDATE_CSER_NA_TRPL_C", "");
			
			this.ds_detail_data.setColumn(row, "UPDATE_CSER_NA_TEAM_C", "");
			this.ds_detail_data.setColumn(row, "UPDATE_SPLR_NA_TRPL_C", "");
			this.ds_detail_data.setColumn(row, "UPDATE_SPLR_NA_TEAM_C", "");
			
			this.ds_detail_data.setColumn(row, "UPDATE_MNGT_NA_TRPL_C", "");
			this.ds_detail_data.setColumn(row, "UPDATE_MNGT_NA_TEAM_C", "");
			this.ds_detail_data.setColumn(row, "UPDATE_MNGT_NA_TR_TPC", "");
			this.ds_detail_data.setColumn(row, "UPDATE_NA_WRS_LCLC",    "");
			this.ds_detail_data.setColumn(row, "UPDATE_NA_WRS_MCLC",    "");
			this.ds_detail_data.setColumn(row, "T1_CSER_TR_REL_AMNNO",  "");
		}
	}
}

//조회 버튼
this.btn_search00_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_ROTS_FLEX_PR_APL_YN.getColumn(0,"ROTS_FLEX_PR_APL_YN") != "1"){
		this.alert('탄력가격협력업체가 아닐경우 조회 되지않습니다.');
		return;
	}
	if(this.div_search.rdo_store_chk00.value == "1"){
		if((this.div_search.cbo_local_code01.value == "1") && (this.gfn_nullToEmpty(this.div_search.edt_bzp_text00.value).length < 2)){
			this.gfn_getMessage('alert','msg.van_ds_sc_1320.view.cser.length');
			return;
		}
		if((this.div_search.cbo_local_code01.value == "2") && (this.gfn_nullToEmpty(this.div_search.edt_bzp_text00.value).length < 8)){
			this.gfn_getMessage('alert','msg.van_ds_sc_1320.view.code.length');
			return;
		}
	}
	this.ds_master_data.clearData();
	this.ds_detail_data.clearData();
	this.flexTrades(2);
}

//그리드 클릭 시 조회
this.grd_afterFnc = function(obj, e)
{
	var mds = this.ds_master_data;
	
	if (e.cell == 1) {
		if (mds.getColumn(mds.rowposition,"CHECK_YN") == "1") {
			this.div_search.sta_cser_c.set_text(mds.getColumn(mds.rowposition,"CSER_NA_TRPL_C"));
			this.div_search.sta_cser_team.set_text(mds.getColumn(mds.rowposition,"CSER_NA_TEAM_C"));
			this.div_search.sta_cser_amnno.set_text(mds.getColumn(mds.rowposition,"CSER_TR_REL_AMNNO"));
			this.flexTrades(3);
		} else {
			this.ds_detail_data.clearData();
		}
	}
}

//저장 버튼
this.btn_save00_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	if(this.ds_detail_data.rowcount == 0){
		this.gfn_getMessage('alert','validation.message.no.parameter');
		return;
	}
	var chkcount = 0;
	for(var i=0;i<this.ds_detail_data.rowcount;i++){
		if(this.ds_detail_data.getColumn(i,"CHECK_YN") == 1 || this.ds_detail_data.getColumn(i,"DELETE_YN") == 1){
			chkcount += 1;
		}
	}
	
	if(chkcount == 0){
		this.alert('저장 할 데이터가 없습니다.');
		return;
	}
	
	var bOk = application.confirm(this.gfn_getTextMessage('msg.van_ds_sc_1310.view.count.msg')+chkcount+this.gfn_getTextMessage('msg.van_ds_sc_1310.view.count.msgf'));
	if(bOk == true){
		this.flexTrades(4);
	}
}

//계통탄력가격적용여부 조회
this.initflex = function()
{
	var json = this.getParamJson(this.components);
	json.TRPL_C = TRPL_C;
	var params = this.getParamJsonToString(json);
	
	var sSvcID        = "p_initflex";//통신아이디
	var sURL          = "svc::rest/pds/partner/Trade/getFlexTrades";// 호출할 서버 페이지 주소
	var sInDatasets   = "";//보내는데이터셋
	var sOutDatasets  = "ds_ROTS_FLEX_PR_APL_YN=ds_ROTS_FLEX_PR_APL_YN";
	var sArgument     = params;// 파라미터
	var sCallbackFunc = "fn_callback";//콜백
	var tranType 	  = "U"; // U:저장/삭제, S:조회	
	//API 호출
	this.gfn_callService(sSvcID, sURL, sInDatasets, sOutDatasets, sArgument, sCallbackFunc, tranType);
}

//마스터, 디테일 저장,수정
this.flexTrades = function(sepVal)
{
	var json = this.getParamJson(this.components);
	json.separator = sepVal;
	json.TRPL_C = TRPL_C;
	json.GUBUN = this.div_search.rdo_store_chk00.value;
	json.local_code = this.div_search.cbo_local_code.value;
	json.na_gubun = this.div_search.cbo_local_code01.value;
	json.schtext = this.gfn_nullToEmpty(this.div_search.edt_bzp_text00.value);
	json.rowp = this.ds_master_data.rowposition;
	json.cser_c = this.gfn_nullToEmpty(this.div_search.sta_cser_c.text);
	json.cser_team = this.gfn_nullToEmpty(this.div_search.sta_cser_team.text);
	json.cser_amnno = this.gfn_nullToEmpty(this.div_search.sta_cser_amnno.text);
	var params = this.getParamJsonToString(json);
	
	var sSvcID        = "";//통신아이디
	var sURL          = "svc::rest/pds/partner/Trade/retrieveFlexTrades";// 호출할 서버 페이지 주소
	var sInDatasets   = "";//보내는데이터셋
	var sOutDatasets  = "";
	var sArgument     = params;// 파라미터
	var sCallbackFunc = "fn_callback";//콜백
	var tranType 	  = "S"; // U:저장/삭제, S:조회
	if(this.div_search.sta_sep_val.text == "1"){
		//마스터 데이터 조회(왼쪽 그리드)
		if(sepVal == "2"){
			var storechk = this.div_search.edt_data01.value;
			if(this.gfn_nullToEmpty(storechk).length < 1){
				this.alert('거래관계를 위한 본지사 정보가 없습니다. \n'+ 
				'본지사 정보 설정을 위해 재 로그인 하시기 바랍니다.');
				return;
			}
			sSvcID = "p_masterSearch"
			sOutDatasets  = "ds_master_data=ds_master_data";
		//디테일 데이터 조회(오른쪽 그리드)
		}else if(sepVal == "3"){
			sSvcID = "p_detailSearch"
			sInDatasets   = "ds_master_data=ds_master_data:A";
			sOutDatasets  = "ds_detail_data=ds_detail_data";
		//디테일 데이터 수정
		}else if(sepVal == "4"){
			sSvcID = "p_detailUpdate"
			sInDatasets = "ds_detail_data=ds_detail_data:A";
		}
		
		this.gfn_callService(sSvcID, sURL, sInDatasets, sOutDatasets, sArgument, sCallbackFunc, tranType);
	}
}

// 조회 성공/실패 여부 시 처리구간
this.fn_callback = function(svcID, nCD, sMSG)
{
	if(nCD < 0 && nCD > -999){
		this.gfn_getMessage("alert", sMSG);
		return;
	}else{
		if(svcID == "p_initflex")
		{
			//계통탄력가격적용 거래처일 경우 본 화면 이용불가 처리
			if(this.ds_ROTS_FLEX_PR_APL_YN.getColumn(0,"ROTS_FLEX_PR_APL_YN") != '1'){
				this.alert('계통탄력가격적용 공급업체가 아닐 경우 탄력가격업체거래관계 화면을 사용하여 3자 거래관계를 등재하실 수 없습니다.\n\n' +
					  '하나로마트거래관계 화면을 이용하여 주시기 바랍니다.');
				return;
			}else{
				this.div_search.sta_sep_val.set_text("1");
			}
		}
		if(svcID =="p_masterSearch"){
			if(this.div_list.grd_main.rowcount < 1){
				this.div_list.grd_detail.set_nodatatext(this.gfn_getTextMessage('result.message.search.no.exist.data'));
			}
		}
		if(svcID == "p_detailSearch")
		{
			if(this.div_list.grd_detail.rowcount < 1){
				this.div_list.grd_detail.set_nodatatext(this.gfn_getTextMessage('result.message.search.no.exist.data'));
				this.gfn_getMessage('alert',this.gfn_getTextMessage('result.message.search.no.exist.data'));
			}
		}
		if(svcID == "p_detailUpdate" && nCD == 1){
			this.alert('주관사업장이 농협하나로마트분사인 수요처와 공급업체의 거래관계를 저장하였습니다.');
		}else if(svcID == "p_detailUpdate" && nCD == -999){
			this.alert(sMSG);
		}
	}
}

//수요처 라디오 버튼 클릭 시 지역,수요처 visible 유무
this.div_search_rdo_store_chk00_onitemchanged = function(obj:Radio, e:nexacro.ItemChangeEventInfo)
{
	var rdochk = this.div_search.rdo_store_chk00.value;
	if(rdochk == 1){	//수요처 일때
		this.div_search.cbo_local_code.set_visible(false);
		this.div_search.cbo_local_code01.set_visible(true);
		this.div_search.edt_bzp_text00.set_visible(true);
		
	}else if(rdochk == 2){	//지역 일때
		this.div_search.cbo_local_code.set_visible(true);
		this.div_search.cbo_local_code01.set_visible(false);
		this.div_search.edt_bzp_text00.set_visible(false);
	}
}

//저장버튼
this.btn_help_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var oArg = {paramMode:"U", dsArg:this.Dataset00};
	var sOption = "autosize=true";
	var sPopupCallBack = "fn_popupAfter";
	this.gfn_openPopup("popId","PDS.PARTNER::VAN_DS_SC_1321.xfdl",oArg,sOption,sPopupCallBack);	
}

this.fn_popupAfter = function(strId, strVal)
{
	trace('팝업완료');
}

//조회 조건 숨김 여부 이벤트
this.div_list_btn_toggle00_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.gfn_searchDivResize(obj, this.div_search, this.div_list);
}


this.btn_clear00_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	this.reload();
}

this.btn_popup01_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
	var pop_trpl = TRPL_C;
	var pop_trplnm = TRPL_N;
	
	var oArg = {paramMode:"A", dsArg:this.ds_master_data, trplc:pop_trpl, trplnm:pop_trplnm};
	var sOption = "autosize=true";
	var sPopupCallBack = "req_popupAfter";
	this.gfn_openPopup("popId","PDS.PARTNER::VAN_DS_SC_1322.xfdl",oArg,sOption,sPopupCallBack);
}

this.div_search_edt_bzp_text00_onkeydown = function(obj:Edit,  e:nexacro.EditClickEventInfo)
{
	if (e.keycode == "13") {
		this.btn_search00.click(); // 조회
	}
}
]]></Script>
  </Form>
</FDL>
